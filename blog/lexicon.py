# lexicon.py
# Расширенный словарь для модерации чатов и форумов

import re

# ===================================================================
# КАТЕГОРИЯ 1: СТРОГО ЗАПРЕЩЕННЫЕ СЛОВА (всегда блокируются)
# ===================================================================

PROHIBITED_WORDS = [
    # Мат и грубые ругательства
    'блядь', 'бля', 'блять', 'сука', 'пизда', 'пиздец', 'ебать', 'ебаный',
    'хуй', 'хер', 'хуйня', 'хрен', 'говно', 'говнюк', 'жопа', 'залупа',
    'мудак', 'мудила', 'чмо', 'чмошник', 'ссука', 'ссыкло', 'гандон',
    'пидор', 'пидар', 'пидорас', 'пидр', 'еблан', 'ебланище', 'дрочер',
    'долбоёб', 'долбаёб', 'ублюдок', 'падла', 'сволочь', 'тварь',

    # Оскорбления и унижения
    'идиот', 'дурак', 'дебил', 'даун', 'кретин', 'имбецил',
    'придурок', 'тупица', 'олигофрен', 'умственно отсталый', 'дебилоид',
    'урод', 'уродина', 'мразь', 'мерзавец', 'подлец', 'шлюха', 'бомж',
    'проститутка', 'потаскуха', 'козел', 'козлина', 'скотина', 'быдло',
    'лох', 'лошара', 'лузер', 'неудачник', 'ничтожество', 'отброс', 'гомик', 'лгбт',

    # Нецензурные варианты и сокращения
    'бл@', 'бл*ть', 'п@зда', 'п*зда', 'ху@', 'х*й', 'еб@ть', 'еб*ть',
    'б[л]', 'п[и]зда', 'х[у]й', 'еб[а]ть', 'бляяяя', 'пздц', 'хйня',
    'епрст', 'ёпрст', 'ёб твою мать', 'ёбаный рот', 'ёба',

    # Расистские и дискриминационные термины
    'нигер', 'чурка', 'хохол', 'жид', 'жидовка', 'азиат', 'узкоглазый',
    'черножопый', 'москаль', 'кацап', 'клюквенная морда', 'пиндос',
    'янки', 'америкос', 'европеец', 'узбек', 'таджик', 'чучмек',

    # Призывы к насилию и угрозы
    'убью', 'убить', 'убийство', 'зарежу', 'прибью', 'пристрелю',
    'повешу', 'задушу', 'сдохни', 'подохни', 'издохни', 'умри', 'сгинь',
    'кидать камни', 'бить', 'избить', 'изнасилую', 'расправлюсь',

    # Нацистская символика и экстремизм (закон РФ)
    'хайль гитлер', '1488', '88', 'зиг хайль', 'adolf hitler', 'нсдап',
    'свастика', 'фашист', 'фашисты', 'нацисты', 'нацизм', 'гитлер',
]

# ===================================================================
# КАТЕГОРИЯ 2: ТОКСИЧНЫЕ ИНДИКАТОРЫ (высокий риск конфликта)
# ===================================================================

TOXIC_INDICATORS = [
    # Оскорбления личности (мягкие варианты)
    'дурак', 'тупой', 'глупый', 'идиот', 'кретин', 'дебил', 'придурок',
    'тупица', 'олух', 'болван', 'остолоп', 'дурень', 'глупец',
    'бестолочь', 'недоумок', 'тормоз', 'невежда', 'профан',

    # Оскорбления внешности и качеств
    'урод', 'уродина', 'страшилище', 'чмо', 'толстяк', 'жирдяй',
    'худышка', 'коротышка', 'уродливый', 'мерзкий', 'отвратительный',
    'гадкий', 'противный', 'мерзость', 'скотина', 'свинья',

    # Агрессивные выражения
    'заткнись', 'заткни пасть', 'заткни варежку', 'закрой рот',
    'заткни свою хлебало', 'молчи', 'отвали', 'проваливай', 'убирайся',
    'иди отсюда', 'катись', 'вали', 'отстань', 'отцепись',

    # Презрительные обращения
    'лох', 'лошара', 'лузер', 'неудачник', 'нищеброд', 'попрошайка',
    'халявщик', 'дармоед', 'тунеядец', 'бездельник', 'лентяй',
    'паразит', 'приспособленец', 'подхалим', 'подлиза', 'подхалимаж',

    # Грубые слова (но не мат)
    'черт', 'чёрт', 'черт возьми', 'чёрт возьми', 'черт побери',
    'блин', 'блинчик', 'ёлки-палки', 'ёшкин кот', 'ёпрст',
    'ядрёна мать', 'японский городовой', 'твою мать', 'твою дивизию',

    # Сексуальные намеки (грубые)
    'трахаться', 'трахать', 'трахнуть', 'переспать', 'шлюха',
    'потаскуха', 'проститутка', 'путана', 'блядина', 'блядовать',
    'развратник', 'развратница', 'шалава', 'шалашовка',

    # Угрозы и агрессия (умеренные)
    'ударю', 'набью морду', 'навешаю люлей', 'получишь', 'огребешь',
    'прибью', 'побью', 'дам в морду', 'дам леща', 'заезжу',
    'получишь по морде', 'настучу', 'избить', 'поломать',

    # Националистические (мягкие формы)
    'понаехали', 'приезжие', 'нерусский', 'чужаки', 'мигранты-уроды',
    'гастарбайтеры', 'понаехавшие', 'откуда понаехали',

    # Политические оскорбления
    'кремлебот', 'либераст', 'либерашка', 'ватник', 'вата', 'ольгинский',
    'ольгинец', 'навальнята', 'майданутый', 'бандеровец', 'укроп',
    'хохлы', 'кацапы', 'москали', 'рашка', 'рашист', 'путлер',

    # Религиозные оскорбления
    'еретик', 'богохульник', 'безбожник', 'сатанист', 'извращенец',
    'бесноватый', 'отступник', 'неверный', 'язычник',
]

# ===================================================================
# КАТЕГОРИЯ 3: СПАМ-ИНДИКАТОРЫ (только явный спам и опасный контент)
# ===================================================================

SPAM_INDICATORS = [
    # ✅ ОСТАВЛЕНЫ: Финансовые пирамиды и мошенничество
    'легкие деньги', 'без вложений', 'пассивный доход',
    'быстрые деньги', 'миллион за месяц', 'финансовая свобода',
    'удвоить капитал', 'гарантированный доход',
    'млм', 'сетевой маркетинг', 'реферальная программа',
    'пригласи друга', 'многоуровневый маркетинг',

    # ✅ ОСТАВЛЕНЫ: Азартные игры и казино
    'казино онлайн', 'слоты', 'игровые автоматы',
    'букмекерская контора', 'выиграть в казино',
    'джекпот', 'бонус при регистрации', 'фриспины',

    # ✅ ОСТАВЛЕНЫ: Подозрительные призывы
    'перейди по ссылке', 'кликни здесь', 'жми сюда',
    'зарегистрируйся здесь', 'получи бонус',
    'скидка 90%', 'акция только сегодня', 'успей купить',

    # ✅ ОСТАВЛЕНЫ: Запрещенные товары (наркотики)
    'купить наркотики', 'закладки', 'марки', 'соли', 'порошок',
    'трава', 'план', 'гашиш', 'героин', 'кокаин', 'амфетамин',
    'экстази', 'фен', 'мефедрон', 'психотропы', 'стимуляторы',

    # ✅ ОСТАВЛЕНЫ: Медицинские товары (подозрительные)
    'виагра', 'сиалис', 'таблетки для потенции', 'дженерики',
    'лекарства без рецепта', 'аптека онлайн',

    # ❌ УБРАНЫ: Обычные слова торговли ('купить', 'продам', 'заказать', 'скидки', 'распродажа')
    # Они могут быть частью нормального общения
]

# ===================================================================
# НАСТРОЙКИ МОДЕРАЦИИ
# ===================================================================

MODERATION_SETTINGS = {
    'max_caps_ratio': 0.7,  # Максимум 70% заглавных букв
    'max_repeat_chars': 4,  # Максимум 4 одинаковых символа подряд
    'max_emojis': 10,  # Максимум 10 эмодзи в сообщении
    'min_message_length': 1,  # Минимум 1 символ
    'max_message_length': 1000,  # Максимум 1000 символов
    'max_links': 2,  # Максимум 2 ссылки в сообщении
    'block_phone_numbers': False,  # Не блокировать телефонные номера
    'block_emails': False,  # Не блокировать email-адреса
}

# ===================================================================
# УРОВНИ СТРОГОСТИ МОДЕРАЦИИ
# ===================================================================

MODERATION_LEVELS = {
    'strict': {  # Строгая модерация (детские форумы)
        'prohibited_words': True,
        'toxic_indicators': True,
        'spam_indicators': True,
        'suspicious_patterns': True,
    },
    'moderate': {  # Умеренная модерация (общие форумы)
        'prohibited_words': True,
        'toxic_indicators': True,
        'spam_indicators': True,  # ✅ ВКЛЮЧЕНО! Теперь проверяет спам
        'suspicious_patterns': True,
    },
    'relaxed': {  # Мягкая модерация (взрослые сообщества)
        'prohibited_words': True,
        'toxic_indicators': True,
        'spam_indicators': True,  # ✅ ВКЛЮЧЕНО! Проверяет явный спам
        'suspicious_patterns': True,
    },
}

# ===================================================================
# ✅ ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ДЛЯ УЛУЧШЕННОЙ ПРОВЕРКИ
# ===================================================================

def normalize_text(text):
    """
    Нормализует текст для более точной проверки:
    - Убирает повторяющиеся символы
    - Убирает пробелы между буквами
    - Убирает спецсимволы (х@й -> хай, х*й -> хй)
    """
    text = text.lower()

    # Убираем повторяющиеся символы (оставляем макс 2)
    text = re.sub(r'(.)\1{2,}', r'\1\1', text)

    # Убираем пробелы между отдельными буквами (макс 1 символ)
    text = re.sub(r'([а-яa-z])\s+([а-яa-z])', r'\1\2', text)

    # Заменяем спецсимволы на буквы
    replacements = {
        '@': 'а', '*': '', '!': 'i', '1': 'i', '3': 'з', 
        '4': 'ч', '6': 'б', '9': 'д', '0': 'о'
    }
    for old, new in replacements.items():
        text = text.replace(old, new)

    return text

def contains_prohibited_word(text, word):
    """
    Умная проверка на наличие запрещенного слова:
    - Проверяет нормализованный текст
    - Проверяет варианты с пробелами
    - Проверяет l33t speak (x@й, x*й)
    """
    normalized = normalize_text(text)
    word_lower = word.lower()

    # Простая проверка
    if word_lower in normalized:
        return True

    # Проверка с regex (границы слов)
    pattern = r'\b' + re.escape(word_lower) + r'\b'
    if re.search(pattern, normalized):
        return True

    # Проверка с пробелами между буквами (х у й)
    spaced_word = ' '.join(list(word_lower))
    if spaced_word in text.lower():
        return True

    return False
